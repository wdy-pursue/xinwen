<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‰ç«¯è°ƒè¯•é¡µé¢</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>å‰ç«¯è°ƒè¯•é¡µé¢</h1>
    <div id="test-results"></div>

    <script>
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = message;
            document.getElementById('test-results').appendChild(div);
            console.log(message);
        }

        async function runTests() {
            log('ğŸ” å¼€å§‹å‰ç«¯è°ƒè¯•...', 'info');

            // æµ‹è¯•1: æ£€æŸ¥APIè¿æ¥
            try {
                log('ğŸ“¡ æµ‹è¯•APIè¿æ¥...', 'info');
                const response = await fetch('/api/news?per_page=3');
                const data = await response.json();
                
                if (data.success) {
                    log(`âœ… APIè¿æ¥æˆåŠŸ! è·å–åˆ° ${data.data.articles.length} ç¯‡æ–‡ç« `, 'success');
                    log(`<pre>${JSON.stringify(data.data.articles[0], null, 2)}</pre>`, 'info');
                } else {
                    log(`âŒ APIè¿”å›é”™è¯¯: ${data.message}`, 'error');
                }
            } catch (error) {
                log(`âŒ APIè¿æ¥å¤±è´¥: ${error.message}`, 'error');
            }

            // æµ‹è¯•2: æ£€æŸ¥DOMå…ƒç´ 
            log('ğŸ” æ£€æŸ¥å…³é”®DOMå…ƒç´ ...', 'info');
            const elements = {
                'news-list': document.getElementById('news-list'),
                'search-input': document.getElementById('search-input'),
                'source-filter': document.getElementById('source-filter'),
                'loading': document.getElementById('loading')
            };

            let allElementsFound = true;
            for (const [name, element] of Object.entries(elements)) {
                if (element) {
                    log(`âœ… æ‰¾åˆ°å…ƒç´ : ${name}`, 'success');
                } else {
                    log(`âŒ æœªæ‰¾åˆ°å…ƒç´ : ${name}`, 'error');
                    allElementsFound = false;
                }
            }

            // æµ‹è¯•3: æ£€æŸ¥CSSæ ·å¼åŠ è½½
            log('ğŸ¨ æ£€æŸ¥CSSæ ·å¼...', 'info');
            const testElement = document.createElement('div');
            testElement.className = 'news-item';
            testElement.style.visibility = 'hidden';
            document.body.appendChild(testElement);
            
            const styles = window.getComputedStyle(testElement);
            if (styles.borderRadius && styles.borderRadius !== '0px') {
                log('âœ… CSSæ ·å¼å·²åŠ è½½', 'success');
            } else {
                log('âŒ CSSæ ·å¼å¯èƒ½æœªæ­£ç¡®åŠ è½½', 'error');
            }
            document.body.removeChild(testElement);

            // æµ‹è¯•4: æ£€æŸ¥JavaScriptæ¨¡å—
            log('ğŸ“ æ£€æŸ¥JavaScriptæ¨¡å—...', 'info');
            if (typeof window.newsManager !== 'undefined') {
                log('âœ… NewsManagerå·²åˆå§‹åŒ–', 'success');
                
                // æ£€æŸ¥NewsManagerçŠ¶æ€
                if (window.newsManager.state) {
                    log(`ğŸ“Š æ–‡ç« æ•°é‡: ${window.newsManager.state.articles?.length || 0}`, 'info');
                    log(`ğŸ“Š å‚å•†æ•°é‡: ${window.newsManager.state.vendors?.length || 0}`, 'info');
                    log(`ğŸ“Š æ˜¯å¦æ­£åœ¨åŠ è½½: ${window.newsManager.state.isLoading}`, 'info');
                }
            } else {
                log('âŒ NewsManageræœªåˆå§‹åŒ–', 'error');
            }

            if (typeof window.mobileOptimizer !== 'undefined') {
                log('âœ… MobileOptimizerå·²åˆå§‹åŒ–', 'success');
            } else {
                log('âŒ MobileOptimizeræœªåˆå§‹åŒ–', 'error');
            }

            log('ğŸ è°ƒè¯•å®Œæˆ!', 'info');
        }

        // é¡µé¢åŠ è½½å®Œæˆåè¿è¡Œæµ‹è¯•
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                setTimeout(runTests, 1000); // å»¶è¿Ÿ1ç§’ç¡®ä¿å…¶ä»–è„šæœ¬åŠ è½½å®Œæˆ
            });
        } else {
            setTimeout(runTests, 1000);
        }
    </script>
</body>
</html>
