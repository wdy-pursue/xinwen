<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>前端调试页面</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>前端调试页面</h1>
    <div id="test-results"></div>

    <script>
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = message;
            document.getElementById('test-results').appendChild(div);
            console.log(message);
        }

        async function runTests() {
            log('🔍 开始前端调试...', 'info');

            // 测试1: 检查API连接
            try {
                log('📡 测试API连接...', 'info');
                const response = await fetch('/api/news?per_page=3');
                const data = await response.json();
                
                if (data.success) {
                    log(`✅ API连接成功! 获取到 ${data.data.articles.length} 篇文章`, 'success');
                    log(`<pre>${JSON.stringify(data.data.articles[0], null, 2)}</pre>`, 'info');
                } else {
                    log(`❌ API返回错误: ${data.message}`, 'error');
                }
            } catch (error) {
                log(`❌ API连接失败: ${error.message}`, 'error');
            }

            // 测试2: 检查DOM元素
            log('🔍 检查关键DOM元素...', 'info');
            const elements = {
                'news-list': document.getElementById('news-list'),
                'search-input': document.getElementById('search-input'),
                'source-filter': document.getElementById('source-filter'),
                'loading': document.getElementById('loading')
            };

            let allElementsFound = true;
            for (const [name, element] of Object.entries(elements)) {
                if (element) {
                    log(`✅ 找到元素: ${name}`, 'success');
                } else {
                    log(`❌ 未找到元素: ${name}`, 'error');
                    allElementsFound = false;
                }
            }

            // 测试3: 检查CSS样式加载
            log('🎨 检查CSS样式...', 'info');
            const testElement = document.createElement('div');
            testElement.className = 'news-item';
            testElement.style.visibility = 'hidden';
            document.body.appendChild(testElement);
            
            const styles = window.getComputedStyle(testElement);
            if (styles.borderRadius && styles.borderRadius !== '0px') {
                log('✅ CSS样式已加载', 'success');
            } else {
                log('❌ CSS样式可能未正确加载', 'error');
            }
            document.body.removeChild(testElement);

            // 测试4: 检查JavaScript模块
            log('📝 检查JavaScript模块...', 'info');
            if (typeof window.newsManager !== 'undefined') {
                log('✅ NewsManager已初始化', 'success');
                
                // 检查NewsManager状态
                if (window.newsManager.state) {
                    log(`📊 文章数量: ${window.newsManager.state.articles?.length || 0}`, 'info');
                    log(`📊 厂商数量: ${window.newsManager.state.vendors?.length || 0}`, 'info');
                    log(`📊 是否正在加载: ${window.newsManager.state.isLoading}`, 'info');
                }
            } else {
                log('❌ NewsManager未初始化', 'error');
            }

            if (typeof window.mobileOptimizer !== 'undefined') {
                log('✅ MobileOptimizer已初始化', 'success');
            } else {
                log('❌ MobileOptimizer未初始化', 'error');
            }

            log('🏁 调试完成!', 'info');
        }

        // 页面加载完成后运行测试
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                setTimeout(runTests, 1000); // 延迟1秒确保其他脚本加载完成
            });
        } else {
            setTimeout(runTests, 1000);
        }
    </script>
</body>
</html>
